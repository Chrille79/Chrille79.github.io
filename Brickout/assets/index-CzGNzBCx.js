(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function t(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=t(i);fetch(i.href,r)}})();function L(){return{score:0,lives:3,level:1,phase:"playing"}}class W{constructor(e){this.keys=new Set,this.mouseX=0,this.useMouseControl=!1,this.canvas=e,this.boundKeyDown=t=>{this.keys.add(t.code),["ArrowLeft","ArrowRight","Space"].includes(t.code)&&t.preventDefault()},this.boundKeyUp=t=>this.keys.delete(t.code),this.boundMouseMove=t=>{this.useMouseControl=!0;const s=this.canvas.getBoundingClientRect();this.mouseX=(t.clientX-s.left)/s.width},window.addEventListener("keydown",this.boundKeyDown),window.addEventListener("keyup",this.boundKeyUp),e.addEventListener("mousemove",this.boundMouseMove)}isKeyDown(e){return this.keys.has(e)}getMouseX(){return this.mouseX}isMouseControlActive(){return this.useMouseControl}consumeKey(e){this.keys.delete(e)}resetMouseControl(){this.useMouseControl=!1}destroy(){window.removeEventListener("keydown",this.boundKeyDown),window.removeEventListener("keyup",this.boundKeyUp),this.canvas.removeEventListener("mousemove",this.boundMouseMove)}}const q=600,R={multiball:"powerup_multiball",expand:"powerup_expand",shrink:"powerup_shrink",slow:"powerup_slow",fast:"powerup_fast",fireball:"powerup_fireball",extralife:"heart"},O=[{type:"multiball",weight:3},{type:"expand",weight:4},{type:"shrink",weight:2},{type:"slow",weight:3},{type:"fast",weight:2},{type:"fireball",weight:2},{type:"extralife",weight:1}],F=O.reduce((o,e)=>o+e.weight,0);function Y(){let o=Math.random()*F;for(const e of O)if(o-=e.weight,o<=0)return e.type;return"multiball"}class z{constructor(e,t,s){this.width=80,this.height=28,this.vy=120,this.alive=!0,this.x=e-this.width/2,this.y=t,this.type=s}update(e){this.y+=this.vy*e,this.y>q+20&&(this.alive=!1)}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}get centerX(){return this.x+this.width/2}get centerY(){return this.y+this.height/2}}const w=800,y=600,U={red:"#ff3366",orange:"#ff8833",yellow:"#ffee33",green:"#33ff66",lightblue:"#33ccff",blue:"#3366ff",purple:"#aa33ff",darkgreen:"#22aa44",steel:"#88aacc",brown:"#aa7744"};class ${constructor(e,t,s){this.bgGradient=null,this.starField=[],this.time=0,this.canvas=e,this.ctx=t,this.assets=s,this.initStarField()}initStarField(){for(let e=0;e<60;e++)this.starField.push({x:Math.random()*w,y:Math.random()*y,size:.5+Math.random()*1.5,speed:5+Math.random()*15,alpha:.2+Math.random()*.5})}getTransform(){const e=this.canvas.width,t=this.canvas.height,s=e/w,i=t/y,r=Math.min(s,i),a=(e-w*r)/2,n=(t-y*r)/2;return{scale:r,offsetX:a,offsetY:n}}beginFrame(e){this.time+=1/60;const t=this.ctx,s=this.canvas.width,i=this.canvas.height;t.fillStyle="#050510",t.fillRect(0,0,s,i);const{scale:r,offsetX:a,offsetY:n}=this.getTransform();t.save();const c=e?e.offsetX:0,d=e?e.offsetY:0;t.translate(a+c*r,n+d*r),t.scale(r,r),t.beginPath(),t.rect(0,0,w,y),t.clip(),this.bgGradient||(this.bgGradient=t.createLinearGradient(0,0,0,y),this.bgGradient.addColorStop(0,"#0a0020"),this.bgGradient.addColorStop(.5,"#0d0030"),this.bgGradient.addColorStop(1,"#1a0040")),t.fillStyle=this.bgGradient,t.fillRect(0,0,w,y),this.drawStarField(),this.drawGrid()}drawStarField(){const e=this.ctx;for(const t of this.starField){t.y+=t.speed*(1/60),t.y>y&&(t.y=0,t.x=Math.random()*w);const s=.5+.5*Math.sin(this.time*3+t.x);e.globalAlpha=t.alpha*s,e.fillStyle="#ffffff",e.beginPath(),e.arc(t.x,t.y,t.size,0,Math.PI*2),e.fill()}e.globalAlpha=1}drawGrid(){const e=this.ctx;e.strokeStyle="rgba(100, 50, 200, 0.08)",e.lineWidth=1;const t=y*.6;for(let r=t;r<y;r+=20){const a=(r-t)/(y-t)*.15;e.strokeStyle=`rgba(100, 50, 200, ${a})`,e.beginPath(),e.moveTo(0,r),e.lineTo(w,r),e.stroke()}const s=y*.5,i=w/2;e.strokeStyle="rgba(100, 50, 200, 0.06)";for(let r=-8;r<=8;r++)e.beginPath(),e.moveTo(i+r*80,y),e.lineTo(i+r*20,s),e.stroke()}endFrame(){this.ctx.restore()}drawPaddle(e){const t=this.ctx,s=this.assets.paddle_medium;s&&(t.save(),t.shadowColor="#00ccff",t.shadowBlur=15,t.drawImage(s,e.x-e.width/2,e.y-e.height/2,e.width,e.height),t.restore())}drawBall(e){const t=this.ctx,s=this.assets.ball;if(s){const i=e.radius*2;t.save(),t.shadowColor=e.fireball?"#ff6600":"#66bbff",t.shadowBlur=e.fireball?30:20,t.translate(e.x,e.y),t.scale(e.scaleX,e.scaleY),t.drawImage(s,-e.radius,-e.radius,i,i),e.fireball&&(t.globalCompositeOperation="overlay",t.fillStyle="rgba(255, 100, 0, 0.5)",t.beginPath(),t.arc(0,0,e.radius,0,Math.PI*2),t.fill(),t.globalCompositeOperation="source-over"),t.restore()}}drawBalls(e){for(const t of e)this.drawBall(t)}drawPowerup(e){if(!e.alive)return;const t=this.ctx,s=R[e.type],i=this.assets[s];if(i){t.save();const r=.7+.3*Math.sin(this.time*6);t.shadowColor="#ffff00",t.shadowBlur=12*r,t.drawImage(i,e.x,e.y,e.width,e.height),t.restore()}}drawPowerups(e){for(const t of e)this.drawPowerup(t)}drawBrick(e){if(!e.alive)return;const t=this.ctx;let s;e.maxHp>1&&e.hp<e.maxHp?s=e.assetKey+"_cracked":s=e.assetKey;const i=this.assets[s]||this.assets[e.assetKey];i&&(t.save(),t.shadowColor=U[e.color]||"#ffffff",t.shadowBlur=8,t.drawImage(i,e.x,e.y,e.width,e.height),t.restore())}drawBricks(e){for(const t of e)this.drawBrick(t)}drawParticles(e){e.render(this.ctx)}drawUI(e,t=!1){const s=this.ctx;s.save(),s.shadowColor="#ff33ff",s.shadowBlur=10,s.fillStyle="#ffffff",s.font='bold 20px "Segoe UI", Arial, sans-serif',s.textAlign="left",s.textBaseline="top",s.fillText(`Score: ${e.score}`,15,10),s.restore(),s.save(),s.shadowColor="#33ffff",s.shadowBlur=8,s.fillStyle="#ffffff",s.font='bold 20px "Segoe UI", Arial, sans-serif',s.textAlign="center",s.textBaseline="top",s.fillText(`Level ${e.level}`,w/2,10),s.restore();const i=this.assets.heart;if(i){const a=w-15-e.lives*29;for(let n=0;n<e.lives;n++)s.save(),s.shadowColor="#ff3366",s.shadowBlur=8,s.drawImage(i,a+n*29,8,24,24),s.restore()}t&&(s.fillStyle="#666666",s.font='14px "Segoe UI", Arial, sans-serif',s.textAlign="right",s.textBaseline="top",s.fillText("[M] Sound OFF",w-15,35))}drawMessage(e,t){const s=this.ctx;s.fillStyle="rgba(0, 0, 0, 0.7)",s.fillRect(0,0,w,y),e&&(s.save(),s.shadowColor="#ff33ff",s.shadowBlur=20,s.fillStyle="#ffffff",s.font='bold 48px "Segoe UI", Arial, sans-serif',s.textAlign="center",s.textBaseline="middle",s.fillText(e,w/2,y/2-20),s.restore()),t&&(s.save(),s.shadowColor="#33ccff",s.shadowBlur=10,s.font='20px "Segoe UI", Arial, sans-serif',s.fillStyle="#aaccff",s.textAlign="center",s.textBaseline="middle",s.fillText(t,w/2,y/2+30),s.restore())}}const N=[{key:"brick_blue",file:"01-Brickout-Tiles.png"},{key:"brick_blue_cracked",file:"02-Brickout-Tiles.png"},{key:"brick_green",file:"03-Brickout-Tiles.png"},{key:"brick_green_cracked",file:"04-Brickout-Tiles.png"},{key:"brick_purple",file:"05-Brickout-Tiles.png"},{key:"brick_purple_cracked",file:"06-Brickout-Tiles.png"},{key:"brick_red",file:"07-Brickout-Tiles.png"},{key:"brick_red_cracked",file:"08-Brickout-Tiles.png"},{key:"brick_orange",file:"09-Brickout-Tiles.png"},{key:"brick_orange_cracked",file:"10-Brickout-Tiles.png"},{key:"brick_lightblue",file:"11-Brickout-Tiles.png"},{key:"brick_lightblue_cracked",file:"12-Brickout-Tiles.png"},{key:"brick_yellow",file:"13-Brickout-Tiles.png"},{key:"brick_yellow_cracked",file:"14-Brickout-Tiles.png"},{key:"brick_darkgreen",file:"15-Brickout-Tiles.png"},{key:"brick_darkgreen_cracked",file:"16-Brickout-Tiles.png"},{key:"brick_steel",file:"17-Brickout-Tiles.png"},{key:"brick_steel_cracked",file:"18-Brickout-Tiles.png"},{key:"brick_brown",file:"19-Brickout-Tiles.png"},{key:"brick_brown_cracked",file:"20-Brickout-Tiles.png"},{key:"square_blue",file:"21-Brickout-Tiles.png"},{key:"square_green",file:"22-Brickout-Tiles.png"},{key:"square_purple",file:"23-Brickout-Tiles.png"},{key:"square_red",file:"24-Brickout-Tiles.png"},{key:"square_orange",file:"25-Brickout-Tiles.png"},{key:"square_yellow",file:"26-Brickout-Tiles.png"},{key:"square_lightblue",file:"27-Brickout-Tiles.png"},{key:"square_darkgreen",file:"28-Brickout-Tiles.png"},{key:"square_steel",file:"29-Brickout-Tiles.png"},{key:"square_brown",file:"30-Brickout-Tiles.png"},{key:"powerup_score50",file:"31-Brickout-Tiles.png"},{key:"powerup_score100_a",file:"32-Brickout-Tiles.png"},{key:"powerup_score100_b",file:"33-Brickout-Tiles.png"},{key:"powerup_score100_c",file:"34-Brickout-Tiles.png"},{key:"powerup_score100_d",file:"35-Brickout-Tiles.png"},{key:"powerup_score250",file:"36-Brickout-Tiles.png"},{key:"powerup_score500",file:"40-Brickout-Tiles.png"},{key:"powerup_slow",file:"41-Brickout-Tiles.png"},{key:"powerup_fast",file:"42-Brickout-Tiles.png"},{key:"powerup_multiball",file:"43-Brickout-Tiles.png"},{key:"powerup_fireball",file:"44-Brickout-Tiles.png"},{key:"powerup_acid",file:"45-Brickout-Tiles.png"},{key:"powerup_shrink",file:"46-Brickout-Tiles.png"},{key:"powerup_expand",file:"47-Brickout-Tiles.png"},{key:"powerup_laser",file:"48-Brickout-Tiles.png"},{key:"powerup_blank",file:"49-Brickout-Tiles.png"},{key:"paddle_medium",file:"50-Brickout-Tiles.png"},{key:"paddle_medium_alt",file:"51-Brickout-Tiles.png"},{key:"paddle_medium_b",file:"52-Brickout-Tiles.png"},{key:"paddle_large",file:"53-Brickout-Tiles.png"},{key:"paddle_medium_c",file:"54-Brickout-Tiles.png"},{key:"paddle_small_a",file:"55-Brickout-Tiles.png"},{key:"paddle_wide",file:"56-Brickout-Tiles.png"},{key:"paddle_tiny",file:"57-Brickout-Tiles.png"},{key:"ball",file:"58-Brickout-Tiles.png"},{key:"star",file:"59-Brickout-Tiles.png"},{key:"heart",file:"60-Brickout-Tiles.png"}];function V(o){return new Promise((e,t)=>{const s=new Image;s.onload=()=>e(s),s.onerror=()=>t(new Error(`Failed to load: ${o}`)),s.src=o})}async function j(){const o={},e="/Brickout/",t=N.map(async({key:s,file:i})=>{o[s]=await V(`${e}${i}`)});return await Promise.all(t),o}const T=800,J=600,b=120,Q=60,Z=200;class H{constructor(){this.width=b,this.targetWidth=b,this.height=28,this.x=T/2,this.y=J-40,this.speed=600}moveLeft(e){this.x-=this.speed*e,this.clamp()}moveRight(e){this.x+=this.speed*e,this.clamp()}moveTo(e){this.x=e*T,this.clamp()}expand(){this.targetWidth=Math.min(this.targetWidth+40,Z)}shrink(){this.targetWidth=Math.max(this.targetWidth-30,Q)}resetSize(){this.targetWidth=b}update(e){const t=this.targetWidth-this.width;Math.abs(t)>.5?this.width+=t*e*8:this.width=this.targetWidth,this.clamp()}clamp(){const e=this.width/2;this.x<e&&(this.x=e),this.x>T-e&&(this.x=T-e)}get left(){return this.x-this.width/2}get right(){return this.x+this.width/2}get top(){return this.y-this.height/2}get bottom(){return this.y+this.height/2}reset(){this.x=T/2,this.width=b,this.targetWidth=b}}const S=800,D=600;class M{constructor(){this.fireball=!1,this.scaleX=1,this.scaleY=1,this.squashTimer=0,this.radius=10,this.speed=400,this.x=S/2,this.y=D-70,this.vx=0,this.vy=0,this.attached=!0}launch(){if(!this.attached)return;this.attached=!1;const e=-Math.PI/2+(Math.random()-.5)*.5;this.vx=Math.cos(e)*this.speed,this.vy=Math.sin(e)*this.speed}update(e){if(this.attached)return;this.x+=this.vx*e,this.y+=this.vy*e;let t=!1;if(this.x-this.radius<0&&(this.x=this.radius,this.vx=Math.abs(this.vx),t=!0),this.x+this.radius>S&&(this.x=S-this.radius,this.vx=-Math.abs(this.vx),t=!0),this.y-this.radius<0&&(this.y=this.radius,this.vy=Math.abs(this.vy),t=!0),t&&this.triggerSquash(),this.squashTimer>0){this.squashTimer-=e;const i=1+.3*Math.max(0,this.squashTimer/.1);this.scaleX=i,this.scaleY=2-i}else this.scaleX=1,this.scaleY=1;return t}triggerSquash(){this.squashTimer=.1}isDead(){return this.y-this.radius>D}attachTo(e,t){this.attached=!0,this.x=e,this.y=t-25,this.vx=0,this.vy=0}reset(e,t){this.attachTo(e,t)}}class ee{constructor(e,t,s,i,r,a=1){this.x=e,this.y=t,this.width=s,this.height=i,this.color=r,this.hp=a,this.maxHp=a,this.alive=!0,this.assetKey=`brick_${r}`,this.points=a*10}hit(){return this.alive?(this.hp--,this.hp<=0?(this.alive=!1,!0):!1):!1}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}get centerX(){return this.x+this.width/2}get centerY(){return this.y+this.height/2}}const te={L:["1..","1..","1..","1..","111"],U:["1.1","1.1","1.1","1.1","111"],C:["111","1..","1..","1..","111"],A:["111","1.1","111","1.1","1.1"],S:["111","1..","111","..1","111"],V:["1.1","1.1","1.1","1.1",".1."],I:["111",".1.",".1.",".1.","111"],N:["1.1","111","111","1.1","1.1"]};function G(o,e){const i=o.length*3+(o.length-1)*1,r=Math.floor((e-i)/2),a=[];for(let n=0;n<5;n++){let c="";for(let d=0;d<e;d++){let u=!1;for(let p=0;p<o.length;p++){const l=r+p*4,k=d-l;if(k>=0&&k<3){const h=te[o[p]];if(h){c+=h[n][k],u=!0;break}}}u||(c+=".")}a.push(c)}return a}function se(o){return()=>{o|=0,o=o+1831565813|0;let e=Math.imul(o^o>>>15,1|o);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const A=["red","orange","yellow","green","lightblue","blue","purple","darkgreen","steel","brown"];function ie(o){const e=se(o*31337+42),t=Math.min((o-2)/98,1),s=Math.floor(4+t*6),i=.45+t*.55,r=t<.2?1:t<.5?2:3,a=t*.5,n=10,c=3+Math.floor(e()*4),d=Math.floor(e()*A.length),u=[];for(let h=0;h<c;h++)u.push(A[(d+h)%A.length]);const p=Math.floor(e()*8),l=[];for(let h=0;h<s;h++){let f="";for(let g=0;g<n;g++){let m=!1;switch(p){case 0:m=e()>i;break;case 1:m=(h+g)%2===0&&e()>.3;break;case 2:{const v=n/2-.5,x=s/2-.5;m=Math.abs(g-v)/(n/2)+Math.abs(h-x)/(s/2)>1}break;case 3:{const v=n/2;m=Math.abs(g-v)<h*.5+.5&&h<s/2}break;case 4:m=e()>i||e()>.5&&g>2&&g<n-2;break;case 5:m=h%2===1&&e()>.3;break;case 6:m=h>0&&h<s-1&&g>0&&g<n-1&&e()>.3;break;case 7:{const v=Math.floor(s/2),x=h<=v?n-h*2:n-(s-1-h)*2,B=Math.floor((n-x)/2);m=g<B||g>=B+x}break}if(m)f+=".";else{const v=r>1&&e()<a?Math.min(Math.floor(e()*r)+1,r):1;f+=v.toString()}}l.push(f)}let k=0;for(const h of l)for(const f of h)f!=="."&&k++;return k<5&&(l[0]="1".repeat(n)),{grid:l,colors:u,cols:n}}function re(){const o=[];o.push({cols:19,colors:["red","orange","yellow","green","purple"],grid:G("LUCAS",19)}),o.push({cols:19,colors:["blue","lightblue","green","yellow","orange"],grid:G("ALVIN",19)});for(let e=3;e<=100;e++)o.push(ie(e));return o}const P=re(),ae=P.length,oe=800,_=4,ne=50,X=28;class C{constructor(e){this.bricks=[],this.levelNumber=e,this.generate()}generate(){const e=this.levelNumber-1;if(e<0||e>=P.length)return;const t=P[e],s=t.cols??10,i=(oe-_*(s+1))/s;this.bricks=[];for(let r=0;r<t.grid.length;r++){const a=t.grid[r],n=t.colors[r%t.colors.length];for(let c=0;c<a.length;c++){const d=a[c];if(d===".")continue;const u=parseInt(d,10)||1,p=_+c*(i+_),l=ne+r*(X+_);this.bricks.push(new ee(p,l,i,X,n,u))}}}get allDestroyed(){return this.bricks.every(e=>!e.alive)}get aliveCount(){return this.bricks.filter(e=>e.alive).length}}class le{checkPaddleCollision(e,t){if(e.vy<0)return!1;if(e.x+e.radius>t.left&&e.x-e.radius<t.right&&e.y+e.radius>t.top&&e.y-e.radius<t.bottom){e.y=t.top-e.radius;const s=(e.x-t.x)/(t.width/2),r=Math.max(-.9,Math.min(.9,s))*(Math.PI/3),a=Math.sqrt(e.vx*e.vx+e.vy*e.vy);return e.vx=Math.sin(r)*a,e.vy=-Math.cos(r)*a,!0}return!1}checkBrickCollisions(e,t){const s={brickHit:null,destroyed:!1,paddleHit:!1};for(const i of t){if(!i.alive)continue;const r=Math.max(i.left,Math.min(e.x,i.right)),a=Math.max(i.top,Math.min(e.y,i.bottom)),n=e.x-r,c=e.y-a;if(n*n+c*c<e.radius*e.radius){const u=e.x+e.radius-i.left,p=i.right-(e.x-e.radius),l=e.y+e.radius-i.top,k=i.bottom-(e.y-e.radius),h=Math.min(u,p),f=Math.min(l,k);h<f?(e.vx=-e.vx,u<p?e.x=i.left-e.radius:e.x=i.right+e.radius):(e.vy=-e.vy,l<k?e.y=i.top-e.radius:e.y=i.bottom+e.radius),s.brickHit=i,s.destroyed=i.hit();break}}return s}}class he{constructor(){this.intensity=0,this.duration=0,this.elapsed=0,this.offsetX=0,this.offsetY=0}trigger(e,t){this.intensity=e,this.duration=t,this.elapsed=0}update(e){if(this.elapsed>=this.duration){this.offsetX=0,this.offsetY=0;return}this.elapsed+=e;const s=1-this.elapsed/this.duration,i=this.intensity*s;this.offsetX=(Math.random()*2-1)*i,this.offsetY=(Math.random()*2-1)*i}get active(){return this.elapsed<this.duration}}class E{constructor(){this.particles=[]}emit(e,t,s,i=12){for(let r=0;r<i;r++){const a=Math.random()*Math.PI*2,n=50+Math.random()*200,c=.3+Math.random()*.5;this.particles.push({x:e,y:t,vx:Math.cos(a)*n,vy:Math.sin(a)*n,life:c,maxLife:c,size:2+Math.random()*4,color:s,alpha:1})}}emitTrail(e,t){Math.random()>.3||this.particles.push({x:e+(Math.random()-.5)*6,y:t+(Math.random()-.5)*6,vx:(Math.random()-.5)*20,vy:(Math.random()-.5)*20,life:.2+Math.random()*.2,maxLife:.4,size:2+Math.random()*2,color:"#66bbff",alpha:.6})}update(e){for(let t=this.particles.length-1;t>=0;t--){const s=this.particles[t];s.x+=s.vx*e,s.y+=s.vy*e,s.vy+=100*e,s.life-=e,s.alpha=Math.max(0,s.life/s.maxLife),s.life<=0&&this.particles.splice(t,1)}}render(e){e.save();for(const t of this.particles)e.globalAlpha=t.alpha,e.fillStyle=t.color,e.beginPath(),e.arc(t.x,t.y,t.size,0,Math.PI*2),e.fill();e.globalAlpha=1,e.restore()}get count(){return this.particles.length}}class ce{constructor(){this.audioCtx=null,this.muted=!1}getCtx(){return this.audioCtx||(this.audioCtx=new AudioContext),this.audioCtx}playTone(e,t,s="square",i=.1){if(!this.muted)try{const r=this.getCtx(),a=r.createOscillator(),n=r.createGain();a.type=s,a.frequency.setValueAtTime(e,r.currentTime),n.gain.setValueAtTime(i,r.currentTime),n.gain.exponentialRampToValueAtTime(.001,r.currentTime+t),a.connect(n),n.connect(r.destination),a.start(r.currentTime),a.stop(r.currentTime+t)}catch{}}paddleHit(){this.playTone(440+Math.random()*60,.1,"triangle",.08)}brickHit(){this.playTone(600+Math.random()*200,.08,"square",.06)}brickDestroy(){this.playTone(800+Math.random()*200,.15,"sawtooth",.08),setTimeout(()=>this.playTone(400+Math.random()*100,.1,"square",.05),30)}wallHit(){this.playTone(300,.05,"sine",.04)}loseLife(){this.playTone(200,.3,"sawtooth",.1),setTimeout(()=>this.playTone(150,.3,"sawtooth",.08),150)}levelComplete(){[523,659,784,1047].forEach((t,s)=>{setTimeout(()=>this.playTone(t,.2,"triangle",.08),s*100)})}gameOver(){[400,350,300,200].forEach((t,s)=>{setTimeout(()=>this.playTone(t,.3,"sawtooth",.08),s*200)})}launch(){this.playTone(350,.1,"triangle",.06),setTimeout(()=>this.playTone(500,.1,"triangle",.06),50)}powerup(){this.playTone(660,.1,"triangle",.08),setTimeout(()=>this.playTone(880,.12,"triangle",.08),60),setTimeout(()=>this.playTone(1100,.15,"triangle",.06),120)}toggleMute(){return this.muted=!this.muted,this.muted}get isMuted(){return this.muted}}const I=1/120,K=.05,fe=.25,ue=8,de={red:"#ff3366",orange:"#ff8833",yellow:"#ffee33",green:"#33ff66",lightblue:"#33ccff",blue:"#3366ff",purple:"#aa33ff",darkgreen:"#22aa44",steel:"#88aacc",brown:"#aa7744"};class pe{constructor(e){this.fireballTimer=0,this.running=!1,this.rafId=0,this.lastTime=0,this.accumulator=0,this.ready=!1,this.GAME_WIDTH=800,this.GAME_HEIGHT=600,this.loop=()=>{if(!this.running)return;this.rafId=requestAnimationFrame(this.loop);const t=performance.now()/1e3;let s=t-this.lastTime;for(this.lastTime=t,s>K&&(s=K),this.accumulator+=s;this.accumulator>=I;)this.update(I),this.accumulator-=I;this.render()},this.canvas=e,this.ctx=e.getContext("2d"),this.input=new W(e)}async start(){this.drawLoadingScreen();const e=await j();this.renderer=new $(this.canvas,this.ctx,e),this.state=L(),this.physics=new le,this.shake=new he,this.particles=new E,this.sound=new ce,this.paddle=new H,this.powerups=[],this.fireballTimer=0;const t=new M;t.attachTo(this.paddle.x,this.paddle.y),this.balls=[t],this.level=new C(1),this.ready=!0,this.running=!0,this.lastTime=performance.now()/1e3,this.accumulator=0,this.loop()}stop(){this.running=!1,this.rafId&&(cancelAnimationFrame(this.rafId),this.rafId=0)}destroy(){this.stop(),this.input.destroy()}drawLoadingScreen(){const e=this.ctx,t=this.canvas.width,s=this.canvas.height;e.fillStyle="#050510",e.fillRect(0,0,t,s),e.save(),e.shadowColor="#ff33ff",e.shadowBlur=15,e.fillStyle="#ffffff",e.font='24px "Segoe UI", Arial, sans-serif',e.textAlign="center",e.textBaseline="middle",e.fillText("Loading...",t/2,s/2),e.restore()}get primaryBall(){return this.balls[0]}update(e){if(!this.ready)return;const{state:t,input:s,paddle:i,balls:r,level:a,physics:n,shake:c,particles:d,sound:u}=this;if(c.update(e),d.update(e),i.update(e),this.fireballTimer>0&&(this.fireballTimer-=e,this.fireballTimer<=0))for(const l of r)l.fireball=!1;if(s.isKeyDown("KeyM")&&(u.toggleMute(),s.consumeKey("KeyM")),t.phase==="gameover"||t.phase==="victory"){(s.isKeyDown("Space")||s.isKeyDown("Enter"))&&this.restartGame();return}if(t.phase==="levelcomplete"){(s.isKeyDown("Space")||s.isKeyDown("Enter"))&&this.nextLevel();return}if(s.isMouseControlActive()){const{scale:l,offsetX:k}=this.renderer.getTransform(),h=this.canvas.getBoundingClientRect(),f=window.devicePixelRatio||1,m=(s.getMouseX()*h.width*f-k)/l;i.x=m;const v=i.width/2;i.x<v&&(i.x=v),i.x>this.GAME_WIDTH-v&&(i.x=this.GAME_WIDTH-v)}else(s.isKeyDown("ArrowLeft")||s.isKeyDown("KeyA"))&&i.moveLeft(e),(s.isKeyDown("ArrowRight")||s.isKeyDown("KeyD"))&&i.moveRight(e);const p=this.primaryBall;if(p.attached){p.x=i.x,p.y=i.y-25,s.isKeyDown("Space")&&(p.launch(),u.launch()),this.updatePowerups(e);return}for(const l of r){if(l.attached)continue;l.fireball&&d.emitTrail(l.x,l.y),d.emitTrail(l.x,l.y),l.update(e)&&u.wallHit(),n.checkPaddleCollision(l,i)&&(l.triggerSquash(),u.paddleHit());const h=n.checkBrickCollisions(l,a.bricks);if(h.brickHit){l.triggerSquash();const f=h.brickHit,g=de[f.color]||"#ffffff";if(l.fireball&&!h.destroyed&&f.alive&&(h.destroyed=!0,f.hp=0,f.alive=!1),h.destroyed){if(t.score+=f.points,d.emit(f.centerX,f.centerY,g,15),c.trigger(4,.12),u.brickDestroy(),Math.random()<fe){const m=Y();this.powerups.push(new z(f.centerX,f.centerY,m))}}else t.score+=5,d.emit(f.centerX,f.centerY,g,5),c.trigger(2,.06),u.brickHit()}}for(let l=r.length-1;l>=0;l--)r[l].isDead()&&r.splice(l,1);if(a.allDestroyed){t.phase="levelcomplete",u.levelComplete(),c.trigger(6,.3);return}if(r.length===0)if(t.lives--,t.lives<=0)t.phase="gameover",u.gameOver(),c.trigger(8,.4);else{u.loseLife(),c.trigger(5,.2);const l=new M;l.attachTo(i.x,i.y),this.balls=[l],this.fireballTimer=0}this.updatePowerups(e)}updatePowerups(e){const{paddle:t,particles:s,sound:i,state:r}=this;for(const a of this.powerups)a.update(e),a.alive&&a.right>t.left&&a.left<t.right&&a.bottom>t.top&&a.top<t.bottom&&(a.alive=!1,i.powerup(),s.emit(a.centerX,a.centerY,"#ffff00",10),this.applyPowerup(a.type));this.powerups=this.powerups.filter(a=>a.alive)}applyPowerup(e){switch(e){case"multiball":this.spawnExtraBalls();break;case"expand":this.paddle.expand();break;case"shrink":this.paddle.shrink();break;case"slow":for(const t of this.balls)t.vx*=.7,t.vy*=.7;break;case"fast":for(const t of this.balls)t.vx*=1.3,t.vy*=1.3;break;case"fireball":this.fireballTimer=ue;for(const t of this.balls)t.fireball=!0;break;case"extralife":this.state.lives++;break}}spawnExtraBalls(){const e=this.balls.find(t=>!t.attached);if(e)for(let t=0;t<2;t++){const s=new M;s.x=e.x,s.y=e.y,s.attached=!1,s.fireball=e.fireball;const i=Math.atan2(e.vy,e.vx)+(t===0?-.4:.4),r=Math.sqrt(e.vx*e.vx+e.vy*e.vy);s.vx=Math.cos(i)*r,s.vy=Math.sin(i)*r,this.balls.push(s)}}render(){if(!this.ready)return;const e=this.renderer;e.beginFrame(this.shake),e.drawBricks(this.level.bricks),e.drawPowerups(this.powerups),e.drawParticles(this.particles),e.drawPaddle(this.paddle),e.drawBalls(this.balls),e.drawUI(this.state,this.sound.isMuted),this.state.phase==="gameover"?e.drawMessage("GAME OVER","Press SPACE to restart"):this.state.phase==="victory"?e.drawMessage("YOU WIN!",`Final score: ${this.state.score} - Press SPACE to play again`):this.state.phase==="levelcomplete"?e.drawMessage("LEVEL COMPLETE!","Press SPACE for next level"):this.primaryBall?.attached&&e.drawMessage("","Press SPACE to launch"),e.endFrame()}restartGame(){this.state=L(),this.paddle=new H;const e=new M;e.attachTo(this.paddle.x,this.paddle.y),this.balls=[e],this.level=new C(1),this.particles=new E,this.powerups=[],this.fireballTimer=0}nextLevel(){if(this.state.level++,this.state.level>ae){this.state.phase="victory",this.sound.levelComplete(),this.shake.trigger(10,.5);return}this.state.phase="playing",this.level=new C(this.state.level),this.paddle.reset();const e=new M;e.attachTo(this.paddle.x,this.paddle.y),this.balls=[e],this.particles=new E,this.powerups=[],this.fireballTimer=0}}class ge extends HTMLElement{constructor(){super(),this.resizeHandler=()=>this.resizeCanvas(),this.shadow=this.attachShadow({mode:"open"})}connectedCallback(){this.shadow.innerHTML=`
      <style>
        :host {
          display: block;
          width: 100vw;
          height: 100vh;
        }
        canvas {
          display: block;
          width: 100%;
          height: 100%;
          background: #0a0a2e;
          cursor: none;
        }
      </style>
      <canvas id="game"></canvas>
    `,this.canvas=this.shadow.getElementById("game"),this.resizeCanvas(),window.addEventListener("resize",this.resizeHandler),this.engine=new pe(this.canvas),this.engine.start()}resizeCanvas(){const e=window.devicePixelRatio||1;this.canvas.width=this.canvas.clientWidth*e,this.canvas.height=this.canvas.clientHeight*e}disconnectedCallback(){window.removeEventListener("resize",this.resizeHandler),this.engine?.destroy()}}customElements.define("game-brickout",ge);

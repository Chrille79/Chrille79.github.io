!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const i of e)if("childList"===i.type)for(const e of i.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();class e{constructor(e){this.keys=new Set,this.mouseX=0,this.useMouseControl=!1,this.canvas=e,this.boundKeyDown=e=>{this.keys.add(e.code),["ArrowLeft","ArrowRight","Space"].includes(e.code)&&e.preventDefault()},this.boundKeyUp=e=>this.keys.delete(e.code),this.boundMouseMove=e=>{this.useMouseControl=!0;const t=this.canvas.getBoundingClientRect();this.mouseX=(e.clientX-t.left)/t.width},window.addEventListener("keydown",this.boundKeyDown),window.addEventListener("keyup",this.boundKeyUp),e.addEventListener("mousemove",this.boundMouseMove)}isKeyDown(e){return this.keys.has(e)}getMouseX(){return this.mouseX}isMouseControlActive(){return this.useMouseControl}consumeKey(e){this.keys.delete(e)}resetMouseControl(){this.useMouseControl=!1}destroy(){window.removeEventListener("keydown",this.boundKeyDown),window.removeEventListener("keyup",this.boundKeyUp),this.canvas.removeEventListener("mousemove",this.boundMouseMove)}}const t={multiball:"powerup_multiball",expand:"powerup_expand",shrink:"powerup_shrink",slow:"powerup_slow",fast:"powerup_fast",fireball:"powerup_fireball",extralife:"heart"},i=[{type:"multiball",weight:3},{type:"expand",weight:4},{type:"shrink",weight:2},{type:"slow",weight:3},{type:"fast",weight:2},{type:"fireball",weight:2},{type:"extralife",weight:1}],s=i.reduce((e,t)=>e+t.weight,0);function r(){let e=Math.random()*s;for(const t of i)if(e-=t.weight,e<=0)return t.type;return"multiball"}class a{constructor(e,t,i){this.width=80,this.height=28,this.vy=120,this.alive=!0,this.x=e-this.width/2,this.y=t,this.type=i}update(e){this.y+=this.vy*e,this.y>620&&(this.alive=!1)}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}get centerX(){return this.x+this.width/2}get centerY(){return this.y+this.height/2}}const l=800,o=600,h={red:"#ff3366",orange:"#ff8833",yellow:"#ffee33",green:"#33ff66",lightblue:"#33ccff",blue:"#3366ff",purple:"#aa33ff",darkgreen:"#22aa44",steel:"#88aacc",brown:"#aa7744"};class n{constructor(e,t,i){this.bgGradient=null,this.starField=[],this.time=0,this.canvas=e,this.ctx=t,this.assets=i,this.initStarField()}initStarField(){for(let e=0;e<60;e++)this.starField.push({x:Math.random()*l,y:Math.random()*o,size:.5+1.5*Math.random(),speed:5+15*Math.random(),alpha:.2+.5*Math.random()})}getTransform(){const e=this.canvas.width,t=this.canvas.height,i=e/l,s=t/o,r=Math.min(i,s);return{scale:r,offsetX:(e-l*r)/2,offsetY:(t-o*r)/2}}beginFrame(e){this.time+=1/60;const t=this.ctx,i=this.canvas.width,s=this.canvas.height;t.fillStyle="#050510",t.fillRect(0,0,i,s);const{scale:r,offsetX:a,offsetY:h}=this.getTransform();t.save();const n=e?e.offsetX:0,c=e?e.offsetY:0;t.translate(a+n*r,h+c*r),t.scale(r,r),t.beginPath(),t.rect(0,0,l,o),t.clip(),this.bgGradient||(this.bgGradient=t.createLinearGradient(0,0,0,o),this.bgGradient.addColorStop(0,"#0a0020"),this.bgGradient.addColorStop(.5,"#0d0030"),this.bgGradient.addColorStop(1,"#1a0040")),t.fillStyle=this.bgGradient,t.fillRect(0,0,l,o),this.drawStarField(),this.drawGrid()}drawStarField(){const e=this.ctx;for(const t of this.starField){t.y+=t.speed*(1/60),t.y>o&&(t.y=0,t.x=Math.random()*l);const i=.5+.5*Math.sin(3*this.time+t.x);e.globalAlpha=t.alpha*i,e.fillStyle="#ffffff",e.beginPath(),e.arc(t.x,t.y,t.size,0,2*Math.PI),e.fill()}e.globalAlpha=1}drawGrid(){const e=this.ctx;e.strokeStyle="rgba(100, 50, 200, 0.08)",e.lineWidth=1;for(let t=360;t<o;t+=20){const i=(t-360)/240*.15;e.strokeStyle=`rgba(100, 50, 200, ${i})`,e.beginPath(),e.moveTo(0,t),e.lineTo(l,t),e.stroke()}e.strokeStyle="rgba(100, 50, 200, 0.06)";for(let t=-8;t<=8;t++)e.beginPath(),e.moveTo(400+80*t,o),e.lineTo(400+20*t,300),e.stroke()}endFrame(){this.ctx.restore()}drawPaddle(e){const t=this.ctx,i=this.assets.paddle_medium;i&&(t.save(),t.shadowColor="#00ccff",t.shadowBlur=15,t.drawImage(i,e.x-e.width/2,e.y-e.height/2,e.width,e.height),t.restore())}drawBall(e){const t=this.ctx,i=this.assets.ball;if(i){const s=2*e.radius;t.save(),t.shadowColor=e.fireball?"#ff6600":"#66bbff",t.shadowBlur=e.fireball?30:20,t.translate(e.x,e.y),t.scale(e.scaleX,e.scaleY),t.drawImage(i,-e.radius,-e.radius,s,s),e.fireball&&(t.globalCompositeOperation="overlay",t.fillStyle="rgba(255, 100, 0, 0.5)",t.beginPath(),t.arc(0,0,e.radius,0,2*Math.PI),t.fill(),t.globalCompositeOperation="source-over"),t.restore()}}drawBalls(e){for(const t of e)this.drawBall(t)}drawPowerup(e){if(!e.alive)return;const i=this.ctx,s=t[e.type],r=this.assets[s];if(r){i.save();const t=.7+.3*Math.sin(6*this.time);i.shadowColor="#ffff00",i.shadowBlur=12*t,i.drawImage(r,e.x,e.y,e.width,e.height),i.restore()}}drawPowerups(e){for(const t of e)this.drawPowerup(t)}drawBrick(e){if(!e.alive)return;const t=this.ctx;let i;i=e.maxHp>1&&e.hp<e.maxHp?e.assetKey+"_cracked":e.assetKey;const s=this.assets[i]||this.assets[e.assetKey];s&&(t.save(),t.shadowColor=h[e.color]||"#ffffff",t.shadowBlur=8,t.drawImage(s,e.x,e.y,e.width,e.height),t.restore())}drawBricks(e){for(const t of e)this.drawBrick(t)}drawParticles(e){e.render(this.ctx)}drawUI(e,t=!1){const i=this.ctx;i.save(),i.shadowColor="#ff33ff",i.shadowBlur=10,i.fillStyle="#ffffff",i.font='bold 20px "Segoe UI", Arial, sans-serif',i.textAlign="left",i.textBaseline="top",i.fillText(`Score: ${e.score}`,15,10),i.restore(),i.save(),i.shadowColor="#33ffff",i.shadowBlur=8,i.fillStyle="#ffffff",i.font='bold 20px "Segoe UI", Arial, sans-serif',i.textAlign="center",i.textBaseline="top",i.fillText(`Level ${e.level}`,400,10),i.restore();const s=this.assets.heart;if(s){const t=24,r=785-e.lives*(t+5);for(let a=0;a<e.lives;a++)i.save(),i.shadowColor="#ff3366",i.shadowBlur=8,i.drawImage(s,r+a*(t+5),8,t,t),i.restore()}t&&(i.fillStyle="#666666",i.font='14px "Segoe UI", Arial, sans-serif',i.textAlign="right",i.textBaseline="top",i.fillText("[M] Sound OFF",785,35))}drawMessage(e,t){const i=this.ctx;i.fillStyle="rgba(0, 0, 0, 0.7)",i.fillRect(0,0,l,o),e&&(i.save(),i.shadowColor="#ff33ff",i.shadowBlur=20,i.fillStyle="#ffffff",i.font='bold 48px "Segoe UI", Arial, sans-serif',i.textAlign="center",i.textBaseline="middle",i.fillText(e,400,280),i.restore()),t&&(i.save(),i.shadowColor="#33ccff",i.shadowBlur=10,i.font='20px "Segoe UI", Arial, sans-serif',i.fillStyle="#aaccff",i.textAlign="center",i.textBaseline="middle",i.fillText(t,400,330),i.restore())}}const c=[{key:"brick_blue",file:"01-Brickout-Tiles.png"},{key:"brick_blue_cracked",file:"02-Brickout-Tiles.png"},{key:"brick_green",file:"03-Brickout-Tiles.png"},{key:"brick_green_cracked",file:"04-Brickout-Tiles.png"},{key:"brick_purple",file:"05-Brickout-Tiles.png"},{key:"brick_purple_cracked",file:"06-Brickout-Tiles.png"},{key:"brick_red",file:"07-Brickout-Tiles.png"},{key:"brick_red_cracked",file:"08-Brickout-Tiles.png"},{key:"brick_orange",file:"09-Brickout-Tiles.png"},{key:"brick_orange_cracked",file:"10-Brickout-Tiles.png"},{key:"brick_lightblue",file:"11-Brickout-Tiles.png"},{key:"brick_lightblue_cracked",file:"12-Brickout-Tiles.png"},{key:"brick_yellow",file:"13-Brickout-Tiles.png"},{key:"brick_yellow_cracked",file:"14-Brickout-Tiles.png"},{key:"brick_darkgreen",file:"15-Brickout-Tiles.png"},{key:"brick_darkgreen_cracked",file:"16-Brickout-Tiles.png"},{key:"brick_steel",file:"17-Brickout-Tiles.png"},{key:"brick_steel_cracked",file:"18-Brickout-Tiles.png"},{key:"brick_brown",file:"19-Brickout-Tiles.png"},{key:"brick_brown_cracked",file:"20-Brickout-Tiles.png"},{key:"square_blue",file:"21-Brickout-Tiles.png"},{key:"square_green",file:"22-Brickout-Tiles.png"},{key:"square_purple",file:"23-Brickout-Tiles.png"},{key:"square_red",file:"24-Brickout-Tiles.png"},{key:"square_orange",file:"25-Brickout-Tiles.png"},{key:"square_yellow",file:"26-Brickout-Tiles.png"},{key:"square_lightblue",file:"27-Brickout-Tiles.png"},{key:"square_darkgreen",file:"28-Brickout-Tiles.png"},{key:"square_steel",file:"29-Brickout-Tiles.png"},{key:"square_brown",file:"30-Brickout-Tiles.png"},{key:"powerup_score50",file:"31-Brickout-Tiles.png"},{key:"powerup_score100_a",file:"32-Brickout-Tiles.png"},{key:"powerup_score100_b",file:"33-Brickout-Tiles.png"},{key:"powerup_score100_c",file:"34-Brickout-Tiles.png"},{key:"powerup_score100_d",file:"35-Brickout-Tiles.png"},{key:"powerup_score250",file:"36-Brickout-Tiles.png"},{key:"powerup_score500",file:"40-Brickout-Tiles.png"},{key:"powerup_slow",file:"41-Brickout-Tiles.png"},{key:"powerup_fast",file:"42-Brickout-Tiles.png"},{key:"powerup_multiball",file:"43-Brickout-Tiles.png"},{key:"powerup_fireball",file:"44-Brickout-Tiles.png"},{key:"powerup_acid",file:"45-Brickout-Tiles.png"},{key:"powerup_shrink",file:"46-Brickout-Tiles.png"},{key:"powerup_expand",file:"47-Brickout-Tiles.png"},{key:"powerup_laser",file:"48-Brickout-Tiles.png"},{key:"powerup_blank",file:"49-Brickout-Tiles.png"},{key:"paddle_medium",file:"50-Brickout-Tiles.png"},{key:"paddle_medium_alt",file:"51-Brickout-Tiles.png"},{key:"paddle_medium_b",file:"52-Brickout-Tiles.png"},{key:"paddle_large",file:"53-Brickout-Tiles.png"},{key:"paddle_medium_c",file:"54-Brickout-Tiles.png"},{key:"paddle_small_a",file:"55-Brickout-Tiles.png"},{key:"paddle_wide",file:"56-Brickout-Tiles.png"},{key:"paddle_tiny",file:"57-Brickout-Tiles.png"},{key:"ball",file:"58-Brickout-Tiles.png"},{key:"star",file:"59-Brickout-Tiles.png"},{key:"heart",file:"60-Brickout-Tiles.png"}];async function u(){const e={},t=c.map(async({key:t,file:i})=>{var s;e[t]=await(s=`/Brickout/${i}`,new Promise((e,t)=>{const i=new Image;i.onload=()=>e(i),i.onerror=()=>t(new Error(`Failed to load: ${s}`)),i.src=s}))});return await Promise.all(t),e}const d=800,f=120;class p{constructor(){this.width=f,this.targetWidth=f,this.height=28,this.x=400,this.y=560,this.speed=600}moveLeft(e){this.x-=this.speed*e,this.clamp()}moveRight(e){this.x+=this.speed*e,this.clamp()}moveTo(e){this.x=e*d,this.clamp()}expand(){this.targetWidth=Math.min(this.targetWidth+40,200)}shrink(){this.targetWidth=Math.max(this.targetWidth-30,60)}resetSize(){this.targetWidth=f}update(e){const t=this.targetWidth-this.width;Math.abs(t)>.5?this.width+=t*e*8:this.width=this.targetWidth,this.clamp()}clamp(){const e=this.width/2;this.x<e&&(this.x=e),this.x>d-e&&(this.x=d-e)}get left(){return this.x-this.width/2}get right(){return this.x+this.width/2}get top(){return this.y-this.height/2}get bottom(){return this.y+this.height/2}reset(){this.x=400,this.width=f,this.targetWidth=f}}class g{constructor(){this.fireball=!1,this.scaleX=1,this.scaleY=1,this.squashTimer=0,this.radius=10,this.speed=400,this.x=400,this.y=530,this.vx=0,this.vy=0,this.attached=!0}launch(){if(!this.attached)return;this.attached=!1;const e=-Math.PI/2+.5*(Math.random()-.5);this.vx=Math.cos(e)*this.speed,this.vy=Math.sin(e)*this.speed}update(e){if(this.attached)return;this.x+=this.vx*e,this.y+=this.vy*e;let t=!1;if(this.x-this.radius<0&&(this.x=this.radius,this.vx=Math.abs(this.vx),t=!0),this.x+this.radius>800&&(this.x=800-this.radius,this.vx=-Math.abs(this.vx),t=!0),this.y-this.radius<0&&(this.y=this.radius,this.vy=Math.abs(this.vy),t=!0),t&&this.triggerSquash(),this.squashTimer>0){this.squashTimer-=e;const t=1+.3*Math.max(0,this.squashTimer/.1);this.scaleX=t,this.scaleY=2-t}else this.scaleX=1,this.scaleY=1;return t}triggerSquash(){this.squashTimer=.1}isDead(){return this.y-this.radius>600}attachTo(e,t){this.attached=!0,this.x=e,this.y=t-25,this.vx=0,this.vy=0}reset(e,t){this.attachTo(e,t)}}class m{constructor(e,t,i,s,r,a=1){this.x=e,this.y=t,this.width=i,this.height=s,this.color=r,this.hp=a,this.maxHp=a,this.alive=!0,this.assetKey=`brick_${r}`,this.points=10*a}hit(){return!!this.alive&&(this.hp--,this.hp<=0&&(this.alive=!1,!0))}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}get centerX(){return this.x+this.width/2}get centerY(){return this.y+this.height/2}}const y={L:["1..","1..","1..","1..","111"],U:["1.1","1.1","1.1","1.1","111"],C:["111","1..","1..","1..","111"],A:["111","1.1","111","1.1","1.1"],S:["111","1..","111","..1","111"],V:["1.1","1.1","1.1","1.1",".1."],I:["111",".1.",".1.",".1.","111"],N:["1.1","111","111","1.1","1.1"]};function w(e,t){const i=3*e.length+1*(e.length-1),s=Math.floor((t-i)/2),r=[];for(let a=0;a<5;a++){let i="";for(let r=0;r<t;r++){let t=!1;for(let l=0;l<e.length;l++){const o=r-(s+4*l);if(o>=0&&o<3){const s=y[e[l]];if(s){i+=s[a][o],t=!0;break}}}t||(i+=".")}r.push(i)}return r}const k=["red","orange","yellow","green","lightblue","blue","purple","darkgreen","steel","brown"];function b(e){const t=(i=31337*e+42,()=>{i=1831565813+(i|=0)|0;let e=Math.imul(i^i>>>15,1|i);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296});var i;const s=Math.min((e-2)/98,1),r=Math.floor(4+6*s),a=.45+.55*s,l=s<.2?1:s<.5?2:3,o=.5*s,h=10,n=3+Math.floor(4*t()),c=Math.floor(t()*k.length),u=[];for(let g=0;g<n;g++)u.push(k[(c+g)%k.length]);const d=Math.floor(8*t()),f=[];for(let g=0;g<r;g++){let e="";for(let i=0;i<h;i++){let s=!1;switch(d){case 0:s=t()>a;break;case 1:s=(g+i)%2==0&&t()>.3;break;case 2:{const e=4.5,t=r/2-.5;s=Math.abs(i-e)/5+Math.abs(g-t)/(r/2)>1}break;case 3:{const e=5;s=Math.abs(i-e)<.5*g+.5&&g<r/2}break;case 4:s=t()>a||t()>.5&&i>2&&i<8;break;case 5:s=g%2==1&&t()>.3;break;case 6:s=g>0&&g<r-1&&i>0&&i<9&&t()>.3;break;case 7:{const e=g<=Math.floor(r/2)?h-2*g:h-2*(r-1-g),t=Math.floor((h-e)/2);s=i<t||i>=t+e}}if(s)e+=".";else{e+=(l>1&&t()<o?Math.min(Math.floor(t()*l)+1,l):1).toString()}}f.push(e)}let p=0;for(const g of f)for(const e of g)"."!==e&&p++;return p<5&&(f[0]="1".repeat(h)),{grid:f,colors:u,cols:h}}const v=function(){const e=[];e.push({cols:19,colors:["red","orange","yellow","green","purple"],grid:w("LUCAS",19)}),e.push({cols:19,colors:["blue","lightblue","green","yellow","orange"],grid:w("ALVIN",19)});for(let t=3;t<=100;t++)e.push(b(t));return e}(),x=v.length;class T{constructor(e){this.bricks=[],this.levelNumber=e,this.generate()}generate(){const e=this.levelNumber-1;if(e<0||e>=v.length)return;const t=v[e],i=t.cols??10,s=(800-4*(i+1))/i;this.bricks=[];for(let r=0;r<t.grid.length;r++){const e=t.grid[r],i=t.colors[r%t.colors.length];for(let t=0;t<e.length;t++){const a=e[t];if("."===a)continue;const l=parseInt(a,10)||1,o=4+t*(s+4),h=50+32*r;this.bricks.push(new m(o,h,s,28,i,l))}}}get allDestroyed(){return this.bricks.every(e=>!e.alive)}get aliveCount(){return this.bricks.filter(e=>e.alive).length}}class M{checkPaddleCollision(e,t){if(e.vy<0)return!1;if(e.x+e.radius>t.left&&e.x-e.radius<t.right&&e.y+e.radius>t.top&&e.y-e.radius<t.bottom){e.y=t.top-e.radius;const i=(e.x-t.x)/(t.width/2),s=Math.max(-.9,Math.min(.9,i))*(Math.PI/3),r=Math.sqrt(e.vx*e.vx+e.vy*e.vy);return e.vx=Math.sin(s)*r,e.vy=-Math.cos(s)*r,!0}return!1}checkBrickCollisions(e,t){const i={brickHit:null,destroyed:!1,paddleHit:!1};for(const s of t){if(!s.alive)continue;const t=Math.max(s.left,Math.min(e.x,s.right)),r=Math.max(s.top,Math.min(e.y,s.bottom)),a=e.x-t,l=e.y-r;if(a*a+l*l<e.radius*e.radius){const t=e.x+e.radius-s.left,r=s.right-(e.x-e.radius),a=e.y+e.radius-s.top,l=s.bottom-(e.y-e.radius);Math.min(t,r)<Math.min(a,l)?(e.vx=-e.vx,e.x=t<r?s.left-e.radius:s.right+e.radius):(e.vy=-e.vy,e.y=a<l?s.top-e.radius:s.bottom+e.radius),i.brickHit=s,i.destroyed=s.hit();break}}return i}}class B{constructor(){this.intensity=0,this.duration=0,this.elapsed=0,this.offsetX=0,this.offsetY=0}trigger(e,t){this.intensity=e,this.duration=t,this.elapsed=0}update(e){if(this.elapsed>=this.duration)return this.offsetX=0,void(this.offsetY=0);this.elapsed+=e;const t=1-this.elapsed/this.duration,i=this.intensity*t;this.offsetX=(2*Math.random()-1)*i,this.offsetY=(2*Math.random()-1)*i}get active(){return this.elapsed<this.duration}}class _{constructor(){this.particles=[]}emit(e,t,i,s=12){for(let r=0;r<s;r++){const s=Math.random()*Math.PI*2,r=50+200*Math.random(),a=.3+.5*Math.random();this.particles.push({x:e,y:t,vx:Math.cos(s)*r,vy:Math.sin(s)*r,life:a,maxLife:a,size:2+4*Math.random(),color:i,alpha:1})}}emitTrail(e,t){Math.random()>.3||this.particles.push({x:e+6*(Math.random()-.5),y:t+6*(Math.random()-.5),vx:20*(Math.random()-.5),vy:20*(Math.random()-.5),life:.2+.2*Math.random(),maxLife:.4,size:2+2*Math.random(),color:"#66bbff",alpha:.6})}update(e){for(let t=this.particles.length-1;t>=0;t--){const i=this.particles[t];i.x+=i.vx*e,i.y+=i.vy*e,i.vy+=100*e,i.life-=e,i.alpha=Math.max(0,i.life/i.maxLife),i.life<=0&&this.particles.splice(t,1)}}render(e){e.save();for(const t of this.particles)e.globalAlpha=t.alpha,e.fillStyle=t.color,e.beginPath(),e.arc(t.x,t.y,t.size,0,2*Math.PI),e.fill();e.globalAlpha=1,e.restore()}get count(){return this.particles.length}}class S{constructor(){this.audioCtx=null,this.muted=!1,this.musicElement=null,this.musicGain=null,this.musicSource=null,this.musicVolume=.3,this.musicPlaying=!1}getCtx(){return this.audioCtx||(this.audioCtx=new AudioContext),this.audioCtx}initMusic(e){this.musicElement=new Audio(e),this.musicElement.loop=!0,this.musicElement.preload="auto"}ensureMusicConnected(){if(this.musicElement&&!this.musicSource)try{const e=this.getCtx();this.musicSource=e.createMediaElementSource(this.musicElement),this.musicGain=e.createGain(),this.musicGain.gain.value=this.musicVolume,this.musicSource.connect(this.musicGain),this.musicGain.connect(e.destination)}catch{}}playMusic(){this.musicElement&&!this.musicPlaying&&(this.ensureMusicConnected(),this.musicElement.play().catch(()=>{}),this.musicPlaying=!0,this.muted&&this.muteMusic())}stopMusic(){this.musicElement&&(this.musicElement.pause(),this.musicElement.currentTime=0,this.musicPlaying=!1)}muteMusic(){this.musicGain?this.musicGain.gain.value=0:this.musicElement&&(this.musicElement.volume=0)}unmuteMusic(){this.musicGain?this.musicGain.gain.value=this.musicVolume:this.musicElement&&(this.musicElement.volume=this.musicVolume)}playTone(e,t,i="square",s=.1){if(!this.muted)try{const r=this.getCtx(),a=r.createOscillator(),l=r.createGain();a.type=i,a.frequency.setValueAtTime(e,r.currentTime),l.gain.setValueAtTime(s,r.currentTime),l.gain.exponentialRampToValueAtTime(.001,r.currentTime+t),a.connect(l),l.connect(r.destination),a.start(r.currentTime),a.stop(r.currentTime+t)}catch{}}paddleHit(){this.playTone(440+60*Math.random(),.1,"triangle",.08)}brickHit(){this.playTone(600+200*Math.random(),.08,"square",.06)}brickDestroy(){this.playTone(800+200*Math.random(),.15,"sawtooth",.08),setTimeout(()=>this.playTone(400+100*Math.random(),.1,"square",.05),30)}wallHit(){this.playTone(300,.05,"sine",.04)}loseLife(){this.playTone(200,.3,"sawtooth",.1),setTimeout(()=>this.playTone(150,.3,"sawtooth",.08),150)}levelComplete(){[523,659,784,1047].forEach((e,t)=>{setTimeout(()=>this.playTone(e,.2,"triangle",.08),100*t)})}gameOver(){[400,350,300,200].forEach((e,t)=>{setTimeout(()=>this.playTone(e,.3,"sawtooth",.08),200*t)})}launch(){this.playTone(350,.1,"triangle",.06),setTimeout(()=>this.playTone(500,.1,"triangle",.06),50)}powerup(){this.playTone(660,.1,"triangle",.08),setTimeout(()=>this.playTone(880,.12,"triangle",.08),60),setTimeout(()=>this.playTone(1100,.15,"triangle",.06),120)}toggleMute(){return this.muted=!this.muted,this.muted?this.muteMusic():this.unmuteMusic(),this.muted}get isMuted(){return this.muted}}const C=1/120,E={red:"#ff3366",orange:"#ff8833",yellow:"#ffee33",green:"#33ff66",lightblue:"#33ccff",blue:"#3366ff",purple:"#aa33ff",darkgreen:"#22aa44",steel:"#88aacc",brown:"#aa7744"};class P{constructor(t){this.fireballTimer=0,this.running=!1,this.rafId=0,this.lastTime=0,this.accumulator=0,this.ready=!1,this.GAME_WIDTH=800,this.GAME_HEIGHT=600,this.loop=()=>{if(!this.running)return;this.rafId=requestAnimationFrame(this.loop);const e=performance.now()/1e3;let t=e-this.lastTime;for(this.lastTime=e,t>.05&&(t=.05),this.accumulator+=t;this.accumulator>=C;)this.update(C),this.accumulator-=C;this.render()},this.canvas=t,this.ctx=t.getContext("2d"),this.input=new e(t)}async start(){this.drawLoadingScreen();const e=await u();this.renderer=new n(this.canvas,this.ctx,e),this.state={score:0,lives:3,level:1,phase:"playing"},this.physics=new M,this.shake=new B,this.particles=new _,this.sound=new S;this.sound.initMusic("/Brickout/Neon Drift Circuit.mp3"),this.paddle=new p,this.powerups=[],this.fireballTimer=0;const t=new g;t.attachTo(this.paddle.x,this.paddle.y),this.balls=[t],this.level=new T(1),this.ready=!0,this.running=!0,this.lastTime=performance.now()/1e3,this.accumulator=0,this.loop()}stop(){this.running=!1,this.rafId&&(cancelAnimationFrame(this.rafId),this.rafId=0)}destroy(){this.stop(),this.input.destroy()}drawLoadingScreen(){const e=this.ctx,t=this.canvas.width,i=this.canvas.height;e.fillStyle="#050510",e.fillRect(0,0,t,i),e.save(),e.shadowColor="#ff33ff",e.shadowBlur=15,e.fillStyle="#ffffff",e.font='24px "Segoe UI", Arial, sans-serif',e.textAlign="center",e.textBaseline="middle",e.fillText("Loading...",t/2,i/2),e.restore()}get primaryBall(){return this.balls[0]}update(e){if(!this.ready)return;const{state:t,input:i,paddle:s,balls:l,level:o,physics:h,shake:n,particles:c,sound:u}=this;if(n.update(e),c.update(e),s.update(e),this.fireballTimer>0&&(this.fireballTimer-=e,this.fireballTimer<=0))for(const r of l)r.fireball=!1;if(i.isKeyDown("KeyM")&&(u.toggleMute(),i.consumeKey("KeyM")),"gameover"===t.phase||"victory"===t.phase)return void((i.isKeyDown("Space")||i.isKeyDown("Enter"))&&this.restartGame());if("levelcomplete"===t.phase)return void((i.isKeyDown("Space")||i.isKeyDown("Enter"))&&this.nextLevel());if(i.isMouseControlActive()){const{scale:e,offsetX:t}=this.renderer.getTransform(),r=this.canvas.getBoundingClientRect(),a=window.devicePixelRatio||1,l=(i.getMouseX()*r.width*a-t)/e;s.x=l;const o=s.width/2;s.x<o&&(s.x=o),s.x>this.GAME_WIDTH-o&&(s.x=this.GAME_WIDTH-o)}else(i.isKeyDown("ArrowLeft")||i.isKeyDown("KeyA"))&&s.moveLeft(e),(i.isKeyDown("ArrowRight")||i.isKeyDown("KeyD"))&&s.moveRight(e);const d=this.primaryBall;if(d.attached)return d.x=s.x,d.y=s.y-25,i.isKeyDown("Space")&&(d.launch(),u.launch(),u.playMusic()),void this.updatePowerups(e);for(const f of l){if(f.attached)continue;f.fireball?(c.emitTrail(f.x,f.y),c.emitTrail(f.x,f.y)):c.emitTrail(f.x,f.y);f.update(e)&&u.wallHit(),h.checkPaddleCollision(f,s)&&(f.triggerSquash(),u.paddleHit());const i=h.checkBrickCollisions(f,o.bricks);if(i.brickHit){f.triggerSquash();const e=i.brickHit,s=E[e.color]||"#ffffff";if(f.fireball&&!i.destroyed&&e.alive&&(i.destroyed=!0,e.hp=0,e.alive=!1),i.destroyed){if(t.score+=e.points,c.emit(e.centerX,e.centerY,s,15),n.trigger(4,.12),u.brickDestroy(),Math.random()<.25){const t=r();this.powerups.push(new a(e.centerX,e.centerY,t))}}else t.score+=5,c.emit(e.centerX,e.centerY,s,5),n.trigger(2,.06),u.brickHit()}}for(let r=l.length-1;r>=0;r--)l[r].isDead()&&l.splice(r,1);if(o.allDestroyed)return t.phase="levelcomplete",u.levelComplete(),void n.trigger(6,.3);if(0===l.length)if(t.lives--,t.lives<=0)t.phase="gameover",u.gameOver(),n.trigger(8,.4);else{u.loseLife(),n.trigger(5,.2);const e=new g;e.attachTo(s.x,s.y),this.balls=[e],this.fireballTimer=0}this.updatePowerups(e)}updatePowerups(e){const{paddle:t,particles:i,sound:s,state:r}=this;for(const a of this.powerups)a.update(e),a.alive&&a.right>t.left&&a.left<t.right&&a.bottom>t.top&&a.top<t.bottom&&(a.alive=!1,s.powerup(),i.emit(a.centerX,a.centerY,"#ffff00",10),this.applyPowerup(a.type));this.powerups=this.powerups.filter(e=>e.alive)}applyPowerup(e){switch(e){case"multiball":this.spawnExtraBalls();break;case"expand":this.paddle.expand();break;case"shrink":this.paddle.shrink();break;case"slow":for(const e of this.balls)e.vx*=.7,e.vy*=.7;break;case"fast":for(const e of this.balls)e.vx*=1.3,e.vy*=1.3;break;case"fireball":this.fireballTimer=8;for(const e of this.balls)e.fireball=!0;break;case"extralife":this.state.lives++}}spawnExtraBalls(){const e=this.balls.find(e=>!e.attached);if(e)for(let t=0;t<2;t++){const i=new g;i.x=e.x,i.y=e.y,i.attached=!1,i.fireball=e.fireball;const s=Math.atan2(e.vy,e.vx)+(0===t?-.4:.4),r=Math.sqrt(e.vx*e.vx+e.vy*e.vy);i.vx=Math.cos(s)*r,i.vy=Math.sin(s)*r,this.balls.push(i)}}render(){if(!this.ready)return;const e=this.renderer;e.beginFrame(this.shake),e.drawBricks(this.level.bricks),e.drawPowerups(this.powerups),e.drawParticles(this.particles),e.drawPaddle(this.paddle),e.drawBalls(this.balls),e.drawUI(this.state,this.sound.isMuted),"gameover"===this.state.phase?e.drawMessage("GAME OVER","Press SPACE to restart"):"victory"===this.state.phase?e.drawMessage("YOU WIN!",`Final score: ${this.state.score} - Press SPACE to play again`):"levelcomplete"===this.state.phase?e.drawMessage("LEVEL COMPLETE!","Press SPACE for next level"):this.primaryBall?.attached&&e.drawMessage("","Press SPACE to launch"),e.endFrame()}restartGame(){this.state={score:0,lives:3,level:1,phase:"playing"},this.paddle=new p;const e=new g;e.attachTo(this.paddle.x,this.paddle.y),this.balls=[e],this.level=new T(1),this.particles=new _,this.powerups=[],this.fireballTimer=0,this.sound.playMusic()}nextLevel(){if(this.state.level++,this.state.level>x)return this.state.phase="victory",this.sound.levelComplete(),void this.shake.trigger(10,.5);this.state.phase="playing",this.level=new T(this.state.level),this.paddle.reset();const e=new g;e.attachTo(this.paddle.x,this.paddle.y),this.balls=[e],this.particles=new _,this.powerups=[],this.fireballTimer=0}}class A extends HTMLElement{constructor(){super(),this.resizeHandler=()=>this.resizeCanvas(),this.shadow=this.attachShadow({mode:"open"})}connectedCallback(){this.shadow.innerHTML='\n      <style>\n        :host {\n          display: block;\n          width: 100vw;\n          height: 100vh;\n        }\n        canvas {\n          display: block;\n          width: 100%;\n          height: 100%;\n          background: #0a0a2e;\n          cursor: none;\n        }\n      </style>\n      <canvas id="game"></canvas>\n    ',this.canvas=this.shadow.getElementById("game"),this.resizeCanvas(),window.addEventListener("resize",this.resizeHandler),this.engine=new P(this.canvas),this.engine.start()}resizeCanvas(){const e=window.devicePixelRatio||1;this.canvas.width=this.canvas.clientWidth*e,this.canvas.height=this.canvas.clientHeight*e}disconnectedCallback(){window.removeEventListener("resize",this.resizeHandler),this.engine?.destroy()}}customElements.define("game-brickout",A);
